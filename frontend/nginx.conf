server {
    listen 8006;
    server_name localhost;
    # Nginx 静态文件根目录（对应 Vue3 打包后的 dist 目录）
    root /usr/share/nginx/html;
    index index.html;

    # 解决 Vue3 SPA 路由刷新 404 问题
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";  # 禁用缓存（开发环境用，生产可调整）
    }

    # 反向代理 Golang 后端接口（/api 前缀转发）
    # 注意：http://backend:8005 中，backend 是 Docker Compose 中后端服务的名称
    location /api/ {
        proxy_pass http://backend:8005;  # 去掉末尾 / 以保留 /api 前缀（如 /api/query → http://backend:8005/api/query）
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;  # 传递真实客户端 IP 到后端
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # 优化：增加超时时间以支持大文件上传和长时间向量化
        proxy_connect_timeout 1800s;  # 连接超时：30分钟
        proxy_send_timeout 1800s;     # 发送超时：30分钟
        proxy_read_timeout 1800s;     # 读取超时：30分钟
        
        # 增加请求体大小限制（与后端保持一致）
        client_max_body_size 500M;
    }

    # 禁止访问 Nginx 隐藏文件（安全优化）
    location ~ /\. {
        deny all;
    }
}